<!DOCTYPE html>
<html
  lang="zh"
  dir="ltr"
  
><meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">


<title>Ubuntu 16.04 安装小记 - 风沙星辰</title>

<meta name="generator" content="Hugo Eureka 0.9.3" />
<link rel="stylesheet" href="/css/eureka.min.285ffbef699dc9f3cf8dcb0803da149f8b646794b7f78a37380928daea2d746cd084512d0a3b592c47d0c71a18a88c7d.css">
<script defer src="/js/eureka.min.fa9a6bf6d7a50bb635b4cca7d2ba5cf3dfb095ae3798773f1328f7950028b48c17d06276594e1b5f244a25a6c969a705.js"></script>













<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link rel="preload"
  href="https://fonts.googleapis.com/css2?family=Lora:wght@400;600;700&amp;family=Noto&#43;Serif&#43;SC:wght@400;600;700&amp;display=swap"
  as="style" onload="this.onload=null;this.rel='stylesheet'">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.4.0/build/styles/base16/solarized-light.min.css"
   media="print"
  onload="this.media='all';this.onload=null" crossorigin>
<script defer src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.4.0/build/highlight.min.js"
   crossorigin></script>
  <script defer src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.4.0/build/languages/dart.min.js"
     crossorigin></script>
<link rel="stylesheet" href="/css/highlightjs.min.2958991528e43eb6fc9b8c4f2b8e052f79c4010718e1d1e888a777620e9ee63021c2c57ec7417a3108019bb8c41943e6.css" media="print" onload="this.media='all';this.onload=null">


<script defer type="text/javascript" src="/js/fontawesome.min.7ecdf591e18d9b7d9a9acfee01f5545be9b15d3fb9a6235fc83f0f7b48df77c7d3fd123037395d75224bf17af86143c1.js"></script>


<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/katex.min.css"
   integrity="sha384-MlJdn/WNKDGXveldHDdyRP1R4CTHr3FeuDNfhsLPYrq2t0UBkUdK2jyTnXPEK1NQ"  media="print"
  onload="this.media='all';this.onload=null" crossorigin>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/katex.min.js" 
  integrity="sha384-VQ8d8WVFw0yHhCk5E8I86oOhv48xLpnDZx5T9GogA/Y84DcCKWXDmSDfn13bzFZY"  crossorigin></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/contrib/auto-render.min.js"
   integrity="sha384-&#43;XBljXPPiv&#43;OzfbB3cVmLHf4hdUFHlWNZN5spNQ7rmHTXpd7WvJum6fIACpNNfIR"  crossorigin></script>
<script>
  document.addEventListener("DOMContentLoaded", function () {
    renderMathInElement(document.body, {
      delimiters: [
        { left: "$$", right: "$$", display: true },
        { left: "$", right: "$", display: false },
        { left: "\\(", right: "\\)", display: false },
        { left: "\\[", right: "\\]", display: true }
      ],
    });
  });
</script>


<script defer src="https://cdn.jsdelivr.net/npm/mermaid@8.14.0/dist/mermaid.min.js" 
  integrity="sha384-atOyb0FxAgN9LyAc6PEf9BjgwLISyansgdH8/VXQH8p2o5vfrRgmGIJ2Sg22L0A0"  crossorigin></script>
<link rel="preconnect" href="https://www.google-analytics.com" crossorigin>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-39209952-2"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag() { dataLayer.push(arguments); }
  gtag('js', new Date());
  gtag('config', 'UA-39209952-2');
</script>


<link rel="icon" type="image/png" sizes="32x32" href="/images/icon_hu3dc7f58c98233f3bfad994ccae960fef_141990_32x32_fill_q75_box_center.jpg">
<link rel="apple-touch-icon" sizes="180x180" href="/images/icon_hu3dc7f58c98233f3bfad994ccae960fef_141990_180x180_fill_q75_box_center.jpg">

<meta name="description"
  content="这台天湖笔记本终于折腾好了">
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [{
      "@type": "ListItem",
      "position": 1 ,
      "name":"Technologies",
      "item":"/technology/"},{
      "@type": "ListItem",
      "position": 2 ,
      "name":"Ubuntu 16.04 安装小记",
      "item":"/technology/ubuntu1604-installation/"}]
}
</script>



<script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "Article",
    "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "/technology/ubuntu1604-installation/"
    },
    "headline": "Ubuntu 16.04 安装小记 - 风沙星辰","datePublished": "2016-04-24T12:17:30+00:00",
    "dateModified": "2016-04-24T12:17:30+00:00",
    "wordCount":  1873 ,
    "publisher": {
        "@type": "Person",
        "name": "Yun LEE",
        "logo": {
            "@type": "ImageObject",
            "url": "/images/icon.jpg"
        }
        },
    "description": "这台天湖笔记本终于折腾好了"
}
</script><meta property="og:title" content="Ubuntu 16.04 安装小记 - 风沙星辰" />
<meta property="og:type" content="article" />


<meta property="og:image" content="/images/icon.jpg">


<meta property="og:url" content="/technology/ubuntu1604-installation/" />



<meta property="og:description" content="这台天湖笔记本终于折腾好了" />



<meta property="og:locale" content="zh" />




<meta property="og:site_name" content="风沙星辰" />






<meta property="article:published_time" content="2016-04-24T12:17:30&#43;00:00" />


<meta property="article:modified_time" content="2016-04-24T12:17:30&#43;00:00" />



<meta property="article:section" content="technology" />


<meta property="article:tag" content="Linux" />






  <body class="flex min-h-screen flex-col">
    <header
      class="min-h-16 pl-scrollbar bg-secondary-bg fixed z-50 flex w-full items-center shadow-sm"
    >
      <div class="mx-auto w-full max-w-screen-xl"><script>
    let storageColorScheme = localStorage.getItem("lightDarkMode")
    if (((storageColorScheme == 'Auto' || storageColorScheme == null) && window.matchMedia("(prefers-color-scheme: dark)").matches) || storageColorScheme == "Dark") {
        document.getElementsByTagName('html')[0].classList.add('dark')
    }
</script>
<nav class="flex items-center justify-between flex-wrap px-4 py-4 md:py-0">
    <a href="/" class="me-6 text-primary-text text-xl font-bold">风沙星辰</a>
    <button id="navbar-btn" class="md:hidden flex items-center px-3 py-2" aria-label="Open Navbar">
        <i class="fas fa-bars"></i>
    </button>

    <div id="target"
        class="hidden block md:flex md:grow md:justify-between md:items-center w-full md:w-auto text-primary-text z-20">
        <div class="md:flex md:h-16 text-sm md:grow pb-4 md:pb-0 border-b md:border-b-0">
            <a href="/technology/" class="block mt-4 md:inline-block md:mt-0 md:h-(16-4px) md:leading-(16-4px) box-border md:border-t-2 md:border-b-2  selected-menu-item  me-4">🖳 技术堆栈</a>
            <a href="/books/" class="block mt-4 md:inline-block md:mt-0 md:h-(16-4px) md:leading-(16-4px) box-border md:border-t-2 md:border-b-2  border-transparent  me-4">🕮 书籍</a>
        </div>

        <div class="flex">
            <div class="relative pt-4 md:pt-0">
                <div class="cursor-pointer hover:text-eureka" id="lightDarkMode">
                    <i class="fas fa-adjust"></i>
                </div>
                <div class="fixed hidden inset-0 opacity-0 h-full w-full cursor-default z-30" id="is-open">
                </div>
                <div class="absolute flex flex-col start-0 md:start-auto end-auto md:end-0 hidden bg-secondary-bg w-48 rounded py-2 border border-tertiary-bg cursor-pointer z-40"
                    id='lightDarkOptions'>
                    <span class="px-4 py-1 hover:text-eureka" name="Light">浅色</span>
                    <span class="px-4 py-1 hover:text-eureka" name="Dark">深色</span>
                    <span class="px-4 py-1 hover:text-eureka" name="Auto">自动</span>
                </div>
            </div>
        </div>
    </div>

    <div class="fixed hidden inset-0 opacity-0 h-full w-full cursor-default z-0" id="is-open-mobile">
    </div>

</nav>
<script>
    
    let element = document.getElementById('lightDarkMode')
    if (storageColorScheme == null || storageColorScheme == 'Auto') {
        document.addEventListener('DOMContentLoaded', () => {
            window.matchMedia("(prefers-color-scheme: dark)").addEventListener('change', switchDarkMode)
        })
    } else if (storageColorScheme == "Light") {
        element.firstElementChild.classList.remove('fa-adjust')
        element.firstElementChild.setAttribute("data-icon", 'sun')
        element.firstElementChild.classList.add('fa-sun')
    } else if (storageColorScheme == "Dark") {
        element.firstElementChild.classList.remove('fa-adjust')
        element.firstElementChild.setAttribute("data-icon", 'moon')
        element.firstElementChild.classList.add('fa-moon')
    }

    document.addEventListener('DOMContentLoaded', () => {
        getcolorscheme();
        switchBurger();
    });
</script>
</div>
    </header>
    <main class="grow pt-16">
        <div class="pl-scrollbar">
          <div class="mx-auto w-full max-w-screen-xl lg:px-4 xl:px-8">
  
  
  <div class="grid grid-cols-2 gap-4 lg:grid-cols-8 lg:pt-12">
    <div
      class=" bg-secondary-bg col-span-2 rounded px-6 py-8 lg:col-span-6"
    >
      <article class="prose">
  <h1 class="mb-4">Ubuntu 16.04 安装小记</h1>

  <div
  class="text-tertiary-text not-prose mt-2 flex flex-row flex-wrap items-center"
>
  <div class="me-6 my-2">
    <i class="fas fa-calendar me-1"></i>
    <span
      >2016-04-24</span
    >
  </div>
  <div class="me-6 my-2">
    <i class="fas fa-clock me-1"></i>
    <span>4分钟阅读时长</span>
  </div>

  
    <div class="me-6 my-2">
      <i class="fas fa-folder me-1"></i>
      
        <a href="/categories/technology/" class="hover:text-eureka"
          >technology</a
        >
      
    </div>
  

  
</div>


  
  

  <h1 id="前言">前言</h1>
<p>Ubuntu大概是最容易安装的一个Linux发行版，因此本文并不是普通意义上的安装教程或新品尝鲜的感受。</p>
<p>本文针对的读者，是那些想在有双显卡（Intel和NVIDIA）的笔记本上安装Ubuntu 16.04的人，以及对我的电脑有浓厚好奇心的观众。</p>
<h1 id="我的电脑">我的电脑</h1>
<p>因为兴趣爱好和使用习惯上的偏好，我在去年年底购入了一台未来人游戏本，打算由此替换掉使用了两年多的Macbook Air，并彻底抛弃Mac平台。</p>
<p>这台未来人的主要配置如下：</p>
<ul>
<li>CPU: Intel i7 6700HQ</li>
<li>GPU:
<ul>
<li>Intel HD 530</li>
<li>NVIDIA GTX 970M</li>
</ul>
</li>
<li>Network Controller: Intel Corporation Wireless 3165</li>
</ul>
<p>这些硬件配置意味着对系统的特殊要求：</p>
<ul>
<li>内核版本在4.2以上才能保证无线网卡的正常工作。</li>
<li>内核版本在4.4以上才能完全支持SkyLake系列CPU。</li>
<li>需要安装闭源驱动才能让独立显卡发挥出最高性能，同时支持双显卡切换。</li>
</ul>
<h1 id="为什么选择ubuntu">为什么选择Ubuntu</h1>
<p>从去年购入电脑之后，因为硬件太新的原因，我不断尝试安装各种不同的发行版，但无一成功，这其中包括：</p>
<ul>
<li>Arch Linux: 我在这台电脑上安装Arch的时候，Kernel 4.4 还没发布，同时由于电脑上其他硬件以及我不信奉Arch哲学的原因，我没有对Arch做更多的尝试。</li>
<li>Gentoo Linux: 我是Gentoo的死忠，这次尝试过Gentoo之后发现，双显卡的设置令我捉摸不透，因此Gentoo暂时搁置。</li>
<li>Redhat系：由于Nouveau的原因，导致安装程序无法正常启动，放弃。</li>
<li>Debian：同上。</li>
<li>Ubuntu：尝试过各种版本号，其中大部分会因Nouveau的问题而挂掉，15.10 和16.04 可以安装上，安装完成后需要手动配置其他东西（内核版本、内核模块、闭源驱动等）；最终我选择了16.04。</li>
</ul>
<h1 id="安装过程">安装过程</h1>
<p>Ubuntu 16.04 的安装过程一如既往地“无痛”。只是，在我这台电脑上安装完成后，无法直接进入系统（因为会死机）。</p>
<h1 id="后续处理">后续处理</h1>
<p>因为Ubuntu 16.04 提供了4.4.0的内核，所以不需要再进行任何方式的内核升级，但因为要处理显卡驱动，所以还要简单处理一下内核模块。</p>
<h2 id="显卡驱动">显卡驱动</h2>
<p>该发行版依旧内置了Nouveau 开源驱动，这是导致频繁死机的直接原因。接下来要做的三件事情是：</p>
<ul>
<li>禁用Nouveau 内核模块</li>
<li>安装Intel HD 530 驱动（二选一）</li>
<li>安装NVIDIA 闭源驱动（二选一）</li>
</ul>
<h3 id="禁用nouveau-内核模块">禁用Nouveau 内核模块</h3>
<p>首先添加一个blacklist:</p>
<pre><code class="language-shell"># vi /etc/modprobe.d/blacklist-nouveau.conf
</code></pre>
<p>在这个文件中写入以下内容：</p>
<pre><code>blacklist nouveau
blacklist lbm-nouveau
options nouveau modeset=0
alias nouveau off
alias lbm-nouveau off
</code></pre>
<p>为了保证完全禁用掉，还要在内核中直接禁用Nouveau:</p>
<pre><code class="language-shell"># echo options nouveau modeset=0 | sudo tee -a /etc/modprobe.d/nouveau-kms.conf
</code></pre>
<p>这之后，更新配置试生效：</p>
<pre><code class="language-shell"># update-initramfs -u
</code></pre>
<p>重启后再次进入系统，就能避免登录之后直接卡死的情况。</p>
<h3 id="安装intel-hd-530-驱动">安装Intel HD 530 驱动</h3>
<p>在进行完以上操作后，可以登录进系统，但卡死的情况仍然频繁发生。解决方案要么是安装Intel的驱动，要么是安装NVIDIA的闭源驱动，可以根据自己的需求来决定。</p>
<p>要安装的是Guc Firmware for SkyLake，可以来<a href="https://01.org/zh/linuxgraphics/downloads/skylake-guc-6.1" target="_blank" rel="noopener">这里</a>
下载。</p>
<p>下载后，解压、安装、重启，电脑即可正常运行。如果不想安装NVIDIA闭源驱动的话，就可以到此结束了。</p>
<p>然而在我的电脑上，只安装Intel驱动会遗留一个Bug：无法支持外接显示器。</p>
<h3 id="安装nvidia闭源驱动">安装NVIDIA闭源驱动</h3>
<p>网上有非常多种安装N卡驱动的方法，根据我的实验，只有最简单的是最靠谱的；用其他方法安装会出现各种意外。</p>
<p>首先打开Ubuntu 自带的Additional Drivers:</p>
<p><img src="menu.png" alt=""></p>
<p>在Additional Drivers标签可以看到，系统已经识别出具体的N卡型号，并给出了闭源驱动的版本号：</p>
<p><img src="additional_driver.png" alt=""></p>
<p>在Terminal 中输入：</p>
<pre><code class="language-shell">$ sudo apt-get install nvidia-[version]    # version为具体的版本号，如图所示为'361'
</code></pre>
<p>安装完毕后，再在Additional Drivers里选择该驱动，重启即可正常使用。</p>
<p><img src="prime.png" alt=""></p>
<p>可以看到，在NVIDIA Settings里，可以进行双显卡切换，不过切换后需要注销并重新登录才能应用设置。</p>
<p>这里有个尚未解决的Bug：在安装了N卡闭源驱动之后，如果在PRIME中选择应用Intel显卡，会出现无法正常关机的情况。因此一旦安装了N卡驱动，就一直使用N卡驱动吧。</p>
<h2 id="输入法">输入法</h2>
<p>我这里安装的是搜狗拼音，分三步：</p>
<ol>
<li>从官网上下载了deb并安装时，会遇到依赖缺失的情况，用<code>apt-get install -f</code>解决。</li>
<li>进入系统设置的语言设置时，会提示语言未安装完全，此处要根据提示进行安装。</li>
<li>安装之后，在语言设置里设置使用Fcitx，在Fcitx设置的Input Method选显卡中记得添加Sogou Pinyin，这时搜狗拼音输入法才会在顶部显示出来。</li>
</ol>
<h1 id="结束">结束</h1>
<p>关于安装，到此告一段落。</p>
<p>然而经理了这么长时间的折腾，我对此还是有些感慨的：</p>
<ol>
<li>不要购买太新的电脑用来跑Linux。</li>
<li>对于驱动软件，我认为闭源驱动比开源驱动更值得信赖。</li>
<li>作为一名Linux用户，应该定期查阅Kernel Mailing List。</li>
</ol>

</article>


      
        <div class="my-4">
    
    <a href="/tags/linux/" class="inline-block bg-tertiary-bg text-sm rounded px-3 py-1 my-1 me-2 hover:text-eureka">#Linux</a>
    
</div>
      

      



      

      
  <div
    class="-mx-2 mt-4 flex flex-col border-t px-2 pt-4 md:flex-row md:justify-between"
  >
    <div>
      
        <span class="text-primary-text block font-bold"
          >上一页</span
        >
        <a href="/technology/how-to-read-open-project/" class="block">高效阅读源代码指南</a>
      
    </div>
    <div class="mt-4 md:mt-0 md:text-right">
      
        <span class="text-primary-text block font-bold">下一页</span>
        <a href="/technology/ux-designer/" class="block">UX Designer</a>
      
    </div>
  </div>


      



  
<div id="disqus_thread"></div>
<script>
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "alvinqi" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>


    </div>
    
      <div class="col-span-2">
        
        
          <div
  class="
    bg-primary-bg
   prose sticky top-16 z-10 hidden px-6 py-4 lg:block"
>
  <h3>本页内容</h3>
</div>
<div
  class="sticky-toc  hidden px-6 pb-6 lg:block"
>
  <nav id="TableOfContents">
  <ul>
    <li><a href="#显卡驱动">显卡驱动</a>
      <ul>
        <li><a href="#禁用nouveau-内核模块">禁用Nouveau 内核模块</a></li>
        <li><a href="#安装intel-hd-530-驱动">安装Intel HD 530 驱动</a></li>
        <li><a href="#安装nvidia闭源驱动">安装NVIDIA闭源驱动</a></li>
      </ul>
    </li>
    <li><a href="#输入法">输入法</a></li>
  </ul>
</nav>
</div>
<script>
  window.addEventListener("DOMContentLoaded", () => {
    enableStickyToc();
  });
</script>

        
      </div>
    

    
    
  </div>

  
    <script>
      document.addEventListener("DOMContentLoaded", () => {
        hljs.highlightAll();
      });
    </script>

          </div>
        </div>
      
    </main>
    <footer class="pl-scrollbar">
      <div class="mx-auto w-full max-w-screen-xl"><div class="text-center p-6 pin-b">
    <p class="text-sm text-tertiary-text">&copy; 2023 <a href="https://blog.oripd.com/">Original Paradigm</a>
 &middot;  Powered by the <a href="https://github.com/wangchucheng/hugo-eureka" target="_blank" class="hover:text-eureka">Eureka</a> theme for <a href="https://gohugo.io" target="_blank" class="hover:text-eureka">Hugo</a></p>
</div></div>
    </footer>
  </body>
</html>
